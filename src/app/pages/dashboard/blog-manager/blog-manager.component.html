<!-- Header -->
<header class="bg-slate-800 border-b border-slate-700 sticky top-14 lg:top-0 z-10">
  <div class="px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-14 md:h-16">
      <div class="min-w-0">
        <h1 class="text-lg md:text-xl font-semibold text-slate-100 truncate">Blog Manager</h1>
        <p class="text-xs md:text-sm text-slate-400 hidden sm:block">Create SEO blogs from HOA articles</p>
      </div>
      <div class="flex items-center space-x-2 flex-shrink-0">
        @if (activeView === 'ideas') {
          <button
            (click)="generateIdeas()"
            [disabled]="isGeneratingIdeas"
            class="btn-primary flex items-center">
            @if (isGeneratingIdeas) {
              <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span class="hidden md:inline">Generating...</span>
            } @else {
              <svg class="w-4 h-4 md:mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              <span class="hidden md:inline">Generate Ideas</span>
            }
          </button>
        }
      </div>
    </div>
  </div>
</header>

<!-- Content -->
<div class="p-4 sm:p-6 lg:p-8">
  <!-- Messages -->
  @if (successMessage) {
    <div class="mb-4 bg-green-500/10 border border-green-500/50 rounded-lg p-3">
      <p class="text-sm text-green-400">{{ successMessage }}</p>
    </div>
  }

  @if (error) {
    <div class="mb-4 bg-red-500/10 border border-red-500/50 rounded-lg p-3">
      <p class="text-sm text-red-400">{{ error }}</p>
    </div>
  }

  @if (processingMessage) {
    <div class="mb-4 bg-blue-500/10 border border-blue-500/50 rounded-lg p-4">
      <div class="flex items-center">
        <svg class="animate-spin mr-3 h-5 w-5 text-blue-400" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="text-sm text-blue-400">{{ processingMessage }}</p>
      </div>
    </div>
  }

  <!-- Stats Cards -->
  <section class="mb-6">
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="card">
        <p class="text-xs text-slate-400 mb-1">Pending Ideas</p>
        <p class="text-2xl font-bold text-amber-400">{{ getPendingCount() }}</p>
      </div>
      <div class="card">
        <p class="text-xs text-slate-400 mb-1">Approved</p>
        <p class="text-2xl font-bold text-green-400">{{ getApprovedCount() }}</p>
      </div>
      <div class="card">
        <p class="text-xs text-slate-400 mb-1">Published Blogs</p>
        <p class="text-2xl font-bold text-indigo-400">{{ getPublishedCount() }}</p>
      </div>
      <div class="card">
        <p class="text-xs text-slate-400 mb-1">Total Views</p>
        <p class="text-2xl font-bold text-slate-100">{{ getTotalViews() }}</p>
      </div>
    </div>
  </section>

  <!-- View Tabs -->
  <div class="flex space-x-1 mb-6 bg-slate-800 p-1 rounded-lg">
    <button
      (click)="setActiveView('ideas')"
      class="flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors"
      [class.bg-indigo-500]="activeView === 'ideas'"
      [class.text-white]="activeView === 'ideas'"
      [class.text-slate-400]="activeView !== 'ideas'">
      Blog Ideas
    </button>
    <button
      (click)="setActiveView('blogs')"
      class="flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors"
      [class.bg-indigo-500]="activeView === 'blogs'"
      [class.text-white]="activeView === 'blogs'"
      [class.text-slate-400]="activeView !== 'blogs'">
      Published Blogs
    </button>
  </div>

  <!-- Ideas View -->
  @if (activeView === 'ideas') {
    <!-- Idea Filters -->
    <div class="flex space-x-2 mb-4 overflow-x-auto">
      <button
        (click)="setIdeaFilter('all')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-indigo-500]="ideaFilter === 'all'"
        [class.text-white]="ideaFilter === 'all'"
        [class.bg-slate-700]="ideaFilter !== 'all'"
        [class.text-slate-300]="ideaFilter !== 'all'">
        All
      </button>
      <button
        (click)="setIdeaFilter('pending')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-amber-500]="ideaFilter === 'pending'"
        [class.text-white]="ideaFilter === 'pending'"
        [class.bg-slate-700]="ideaFilter !== 'pending'"
        [class.text-slate-300]="ideaFilter !== 'pending'">
        Pending Review
      </button>
      <button
        (click)="setIdeaFilter('approved')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-green-500]="ideaFilter === 'approved'"
        [class.text-white]="ideaFilter === 'approved'"
        [class.bg-slate-700]="ideaFilter !== 'approved'"
        [class.text-slate-300]="ideaFilter !== 'approved'">
        Ready to Generate
      </button>
      <button
        (click)="setIdeaFilter('generated')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-indigo-500]="ideaFilter === 'generated'"
        [class.text-white]="ideaFilter === 'generated'"
        [class.bg-slate-700]="ideaFilter !== 'generated'"
        [class.text-slate-300]="ideaFilter !== 'generated'">
        Generated
      </button>
    </div>

    @if (isLoading) {
      <div class="space-y-4">
        @for (i of [1, 2, 3]; track i) {
          <div class="card">
            <app-loading-skeleton height="100px"></app-loading-skeleton>
          </div>
        }
      </div>
    } @else if (ideas.length === 0) {
      <div class="card text-center py-12">
        <svg class="w-16 h-16 mx-auto text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
        <p class="text-slate-400 text-lg mb-2">No Blog Ideas</p>
        <p class="text-slate-500 text-sm mb-4">Generate ideas from your collected HOA news articles</p>
        <button (click)="generateIdeas()" [disabled]="isGeneratingIdeas" class="btn-primary">
          {{ isGeneratingIdeas ? 'Generating...' : 'Generate Ideas' }}
        </button>
      </div>
    } @else {
      <div class="space-y-4">
        @for (idea of ideas; track idea.id) {
          <div
            class="card cursor-pointer hover:border-slate-600 transition-colors"
            [class.border-indigo-500]="selectedIdea?.id === idea.id"
            (click)="selectIdea(idea)">
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-2">
                  <h3 class="text-sm font-medium text-slate-100">{{ idea.title }}</h3>
                  <span
                    class="px-2 py-0.5 rounded text-xs font-medium flex-shrink-0"
                    [class]="getIdeaStatusBgColor(idea.status)"
                    [class]="getIdeaStatusColor(idea.status)">
                    {{ idea.status }}
                  </span>
                </div>
                <p class="text-xs text-slate-400 mb-2">{{ idea.description }}</p>
                <div class="flex items-center gap-3 text-xs text-slate-500">
                  <span>{{ formatDate(idea.created_at) }}</span>
                  @if (idea.target_keywords && idea.target_keywords.length > 0) {
                    <span class="hidden sm:inline">Keywords: {{ idea.target_keywords.slice(0, 3).join(', ') }}</span>
                  }
                </div>
              </div>

              <!-- Quick Actions -->
              @if (idea.status === 'pending') {
                <div class="flex gap-2 flex-shrink-0">
                  <button
                    (click)="approveIdea(idea); $event.stopPropagation()"
                    class="p-2 rounded-lg bg-green-500/20 text-green-400 hover:bg-green-500/30 transition-colors"
                    title="Approve">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                  </button>
                  <button
                    (click)="rejectIdea(idea); $event.stopPropagation()"
                    class="p-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-colors"
                    title="Reject">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              }

              @if (idea.status === 'approved') {
                <button
                  (click)="generateBlogFromIdea(idea); $event.stopPropagation()"
                  [disabled]="generatingBlogId === idea.id"
                  class="btn-primary text-xs flex-shrink-0">
                  @if (generatingBlogId === idea.id) {
                    <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                  } @else {
                    Generate Blog
                  }
                </button>
              }
            </div>

            <!-- Expanded Details -->
            @if (selectedIdea?.id === idea.id) {
              <div class="mt-4 pt-4 border-t border-slate-700">
                @if (idea.angle) {
                  <div class="mb-3">
                    <p class="text-xs text-slate-500 mb-1">Angle/Hook:</p>
                    <p class="text-sm text-slate-300">{{ idea.angle }}</p>
                  </div>
                }

                @if (idea.target_keywords && idea.target_keywords.length > 0) {
                  <div class="mb-3">
                    <p class="text-xs text-slate-500 mb-1">Target Keywords:</p>
                    <div class="flex flex-wrap gap-1">
                      @for (keyword of idea.target_keywords; track keyword) {
                        <span class="px-2 py-0.5 bg-slate-700 rounded text-xs text-slate-300">{{ keyword }}</span>
                      }
                    </div>
                  </div>
                }

                <div class="flex gap-2 mt-4">
                  @if (idea.status === 'pending') {
                    <button
                      (click)="approveIdea(idea); $event.stopPropagation()"
                      class="btn-secondary text-xs text-green-400 border-green-500/30">
                      Approve
                    </button>
                    <button
                      (click)="rejectIdea(idea); $event.stopPropagation()"
                      class="btn-secondary text-xs text-red-400 border-red-500/30">
                      Reject
                    </button>
                  }
                  <button
                    (click)="deleteIdea(idea); $event.stopPropagation()"
                    class="btn-secondary text-xs text-red-400 border-red-500/30">
                    Delete
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  }

  <!-- Blogs View -->
  @if (activeView === 'blogs') {
    <!-- Blog Filters -->
    <div class="flex space-x-2 mb-4 overflow-x-auto">
      <button
        (click)="setBlogFilter('all')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-indigo-500]="blogFilter === 'all'"
        [class.text-white]="blogFilter === 'all'"
        [class.bg-slate-700]="blogFilter !== 'all'"
        [class.text-slate-300]="blogFilter !== 'all'">
        All
      </button>
      <button
        (click)="setBlogFilter('published')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-green-500]="blogFilter === 'published'"
        [class.text-white]="blogFilter === 'published'"
        [class.bg-slate-700]="blogFilter !== 'published'"
        [class.text-slate-300]="blogFilter !== 'published'">
        Published
      </button>
      <button
        (click)="setBlogFilter('draft')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-amber-500]="blogFilter === 'draft'"
        [class.text-white]="blogFilter === 'draft'"
        [class.bg-slate-700]="blogFilter !== 'draft'"
        [class.text-slate-300]="blogFilter !== 'draft'">
        Drafts
      </button>
      <button
        (click)="setBlogFilter('archived')"
        class="px-3 py-1 rounded-full text-xs font-medium transition-colors whitespace-nowrap"
        [class.bg-slate-600]="blogFilter === 'archived'"
        [class.text-white]="blogFilter === 'archived'"
        [class.bg-slate-700]="blogFilter !== 'archived'"
        [class.text-slate-300]="blogFilter !== 'archived'">
        Archived
      </button>
    </div>

    @if (blogs.length === 0) {
      <div class="card text-center py-12">
        <svg class="w-16 h-16 mx-auto text-slate-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
        </svg>
        <p class="text-slate-400 text-lg mb-2">No Blogs Yet</p>
        <p class="text-slate-500 text-sm">Generate ideas and create blogs from approved ideas</p>
      </div>
    } @else {
      <div class="space-y-4">
        @for (blog of blogs; track blog.id) {
          <div
            class="card cursor-pointer hover:border-slate-600 transition-colors"
            [class.border-indigo-500]="selectedBlog?.id === blog.id"
            (click)="selectBlog(blog)">
            <div class="flex gap-4">
              <!-- Image -->
              @if (blog.image_url) {
                <div class="hidden sm:block w-32 h-24 flex-shrink-0 rounded-lg overflow-hidden bg-slate-700">
                  <img [src]="blog.image_url" [alt]="blog.image_alt || blog.title" class="w-full h-full object-cover">
                </div>
              }

              <!-- Content -->
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-2 mb-2">
                  <h3 class="text-sm font-medium text-slate-100 line-clamp-1">{{ blog.title }}</h3>
                  <span
                    class="px-2 py-0.5 rounded text-xs font-medium flex-shrink-0"
                    [class]="getBlogStatusBgColor(blog.status)"
                    [class]="getBlogStatusColor(blog.status)">
                    {{ blog.status }}
                  </span>
                </div>

                <p class="text-xs text-slate-400 line-clamp-2 mb-2">{{ blog.excerpt }}</p>

                <div class="flex items-center gap-4 text-xs text-slate-500">
                  <span>{{ formatDate(blog.published_at) }}</span>
                  <span>{{ blog.read_time_minutes }} min read</span>
                  <span>{{ blog.view_count || 0 }} views</span>
                </div>
              </div>
            </div>

            <!-- Expanded Actions -->
            @if (selectedBlog?.id === blog.id) {
              <div class="mt-4 pt-4 border-t border-slate-700">
                <div class="flex flex-wrap gap-2 mb-4">
                  <button
                    (click)="copyBlogUrl(blog); $event.stopPropagation()"
                    class="btn-secondary text-xs">
                    Copy URL
                  </button>

                  @if (blog.status !== 'published') {
                    <button
                      (click)="updateBlogStatus(blog, 'published'); $event.stopPropagation()"
                      class="btn-secondary text-xs text-green-400 border-green-500/30">
                      Publish
                    </button>
                  }

                  @if (blog.status === 'published') {
                    <button
                      (click)="updateBlogStatus(blog, 'draft'); $event.stopPropagation()"
                      class="btn-secondary text-xs text-amber-400 border-amber-500/30">
                      Unpublish
                    </button>
                  }

                  @if (blog.status !== 'archived') {
                    <button
                      (click)="updateBlogStatus(blog, 'archived'); $event.stopPropagation()"
                      class="btn-secondary text-xs">
                      Archive
                    </button>
                  }

                  <button
                    (click)="deleteBlog(blog); $event.stopPropagation()"
                    class="btn-secondary text-xs text-red-400 border-red-500/30">
                    Delete
                  </button>
                </div>

                <!-- SEO Info -->
                <div class="p-3 bg-slate-700/30 rounded-lg mb-3">
                  <h4 class="text-xs font-medium text-slate-300 mb-2">SEO Info</h4>
                  <div class="space-y-1 text-xs text-slate-400">
                    <p><span class="text-slate-500">Title:</span> {{ blog.seo_title }}</p>
                    <p><span class="text-slate-500">Description:</span> {{ blog.seo_description }}</p>
                    @if (blog.seo_keywords && blog.seo_keywords.length > 0) {
                      <p><span class="text-slate-500">Keywords:</span> {{ blog.seo_keywords.join(', ') }}</p>
                    }
                  </div>
                </div>

                <!-- Content Preview -->
                <div class="p-3 bg-slate-700/30 rounded-lg max-h-48 overflow-y-auto">
                  <h4 class="text-xs font-medium text-slate-300 mb-2">Content Preview</h4>
                  <div class="text-xs text-slate-400 whitespace-pre-wrap">{{ getContentPreview(blog.content) }}...</div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  }
</div>
